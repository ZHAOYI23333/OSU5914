<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>FriendFinder</title>

  <!-- Bootstrap core CSS -->
  <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
<link href="static/css/simple-sidebar.css" rel="stylesheet">

  <!-- Custom fonts -->
  <link href="https://fonts.googleapis.com/css?family=Lobster&display=swap" rel="stylesheet">

  <!-- Custom styles -->
  <link href="static/css/custom.css" rel="stylesheet">

</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom">
    <button class="navbar-toggler" id="menu-toggle">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="#">FriendFinder</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <div class="list-group list-group-flush">
        <a href="#" class="list-group-item list-group-item-action bg-light">Automated Friend Finder</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Find Friend by Specific Interest</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Automated Wingman (dating service)</a>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <div class="container-fluid">

        <div class="jumbotron jumbotron-fluid">
          <div class="container">
            <h1 class="display-4">Find your friends.</h1>
            <p class="lead">Find nearby friends.</p>
          </div>
        </div>
      
        <label for="exampleInputEmail1">Enter Twitter Info</label>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon1">@</span>
          </div>
          <input type="text" id="twitter-handle-input" class="form-control" placeholder="Username" aria-label="emailHelp">
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon2">Location</span>
          </div>
          <input type="text" id="location-input" class="form-control" placeholder="-74,40,-73,41" aria-label="Location">
        </div>
        <button type="submit" class="btn btn-primary btn-block" id="twitter-handle-submit-btn">Find Friends</button>
        <small id="emailHelp" class="form-text text-muted">Find nearby twitter accounts with similar interests.</small>

        <br><br>
        <h3>Interests Detected (in order of confidence):</h3>

        <div class='container-fluid'>
          <div class="row">
            <div class="text-center">
                <div class="list-group list-group-horizontal" id="self-interest-div">
                </div>
              </div>
          </div>
        </div>
        <br>
        <h3>Nearby Twitter Accounts:</h3>
        <table class="table" id="friend-table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Handle</th>
              <th scope="col">Match Score</th>
              <th scope="col">Similar Interests</th>
              <th scope="col">Profile Pic</th>
            </tr>
          </thead>
          <tbody id="friend-table-body">
          </tbody>
        </table>

      </div>
      
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <script src="static/vendor/jquery/jquery.min.js"></script>
  <script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Menu Toggle Script -->
  <script>
    function getInterests(handle, callback) {
      $.getJSON('/interests/' + handle, (data, status) => {
        if (status !== "success") {
          alert('Could\'nt get your interests. Sorry');
          return;
        }

        callback(data);
      })
    }

    function displayInterests(interests) {
      let interestDiv = $('#self-interest-div');

      var value;
      Object.keys(interests).forEach(function(key) {
          value = interests[key];
          var intP = document.createElement('p');
          intP.className = 'list-group-item';
          intP.innerHTML = value;
          interestDiv.append(intP);
      });
      
    }

    function displayFriend(idx, handle, score, interests, image) {
      let friendDiv = $('#friend-table-body');

      var frRow = document.createElement('tr');

      var frScope = document.createElement('th');
      frScope.setAttribute('scope', 'row');
      frScope.innerHTML = idx;

      var frHandle = document.createElement('td');
      frHandle.innerHTML = handle;

      var frScore = document.createElement('td');
      frScope.innerHTML = score;

      var frInt = document.createElement('td');
      frInt.innerHTML = interests.join(', ');

      var frImage = document.createElement('td');

      frRow.append(frScope, frHandle, frScore, frInt, image);
      friendDiv.append(frRow);
    }
    
    function displayFriends(friends) {
      for (var i = 0; i < friends.length; i++)
        displayFriend(i, friends[i]['handle'], friends[i]['score'], friends[i]['interests'], friends[i]['image']);
    }

    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });

    $('#twitter-handle-submit-btn').click(() => {
      let handle = $('#twitter-handle-input').val();
      let location = $('#location-input').val();

      let interestDiv = document.getElementById('self-interest-div');
      while (interestDiv.firstChild)
        interestDiv.removeChild(interestDiv.firstChild);

      let friendDiv = document.getElementById('friend-table-body');
      while (friendDiv.firstChild)
        friendDiv.removeChild(friendDiv.firstChild);

      $.post('/user/' + encodeURIComponent(handle) + '?location=' + encodeURIComponent(location), (data, status, xhr) => {
        if (status !== "success") {
          alert('Couldn\'t upload you into our database. Sorry');
          return;
        }

        $.getJSON('/friends_and_interests/' + encodeURIComponent(handle) + '/' + encodeURIComponent(location), (friends_and_interests, status) => {
          if (status !== "success") {
            alert('Couldn\'t get your friends. Sorry');
            return;
          }

          friends = friends_and_interests.friends;
          interests = friends_and_interests.interests;
          alert(friends)

          displayInterests(interests);
          displayFriends(friends);
        });
      })
    })
  </script>

</body>

</html>
